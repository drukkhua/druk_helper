# üí∞ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ OpenAI —Ç–æ–∫–µ–Ω—ã

## üîç **–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è —Å —Ä–µ–∂–∏–º–æ–º `/compare`:**

**–î–∞, —Ä–µ–∂–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤!**

```python
# –ö–æ–¥ –≤ enhanced_ai_handlers.py —Å—Ç—Ä–æ–∫–∏ 319-322
tasks = [
    ai_service.process_query(user_text, user_id, lang),           # 1-–π –∑–∞–ø—Ä–æ—Å
    enhanced_ai_service.process_query(user_text, user_id, lang)   # 2-–π –∑–∞–ø—Ä–æ—Å
]
```

## üí° **–í–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

### 1. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–µ–∂–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è**
```python
# –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏–ª–∏ –ø–µ—Ä–≤—ã—Ö N –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
if user_id not in ADMIN_USER_IDS:
    daily_comparisons = get_user_daily_comparisons(user_id)
    if daily_comparisons >= 3:  # –õ–∏–º–∏—Ç 3 —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –¥–µ–Ω—å
        await message.answer("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–π (3/–¥–µ–Ω—å)")
        return
```

### 2. **–°–æ–∑–¥–∞—Ç—å Mock-—Ä–µ–∂–∏–º –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
if not user_in_premium_plan(user_id):
    # –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    await show_demo_comparison(message)
    return
```

### 3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
```python
# –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
cache_key = f"compare_{hash(user_text)}_{lang}"
cached_result = redis.get(cache_key)
if cached_result:
    await message.answer(cached_result)
    return
```

### 4. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º "Smart Preview"**
```python
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ Enhanced AI + –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π
# –í–º–µ—Å—Ç–æ –¥–≤—É—Ö –ø–æ–ª–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
enhanced_result = await enhanced_ai_service.process_query(...)
comparison_note = generate_comparison_note(enhanced_result)
```

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å—Ö–æ–¥–æ–≤:**

### –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω—Å–∫—É—é –ø–∞–Ω–µ–ª—å:
```python
@router.message(Command("token_usage"))
async def cmd_token_usage(message):
    if message.from_user.id not in ADMIN_USER_IDS:
        return

    today_usage = analytics_service.get_token_usage_today()
    comparison_usage = analytics_service.get_comparison_mode_usage()

    report = f"""
üìä **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å–µ–≥–æ–¥–Ω—è:**
‚Ä¢ –í—Å–µ–≥–æ: {today_usage['total']} —Ç–æ–∫–µ–Ω–æ–≤
‚Ä¢ –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º: {today_usage['normal']} —Ç–æ–∫–µ–Ω–æ–≤
‚Ä¢ –†–µ–∂–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: {today_usage['comparison']} —Ç–æ–∫–µ–Ω–æ–≤ (2x)
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–π: {comparison_usage['percentage']:.1f}%
‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ /compare: ${today_usage['potential_savings']:.2f}
"""
    await message.answer(report)
```

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**

1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –¥–≤–æ–π–Ω–æ–º —Ä–∞—Å—Ö–æ–¥–µ —Ç–æ–∫–µ–Ω–æ–≤ ‚úÖ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

2. **–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–µ–∂–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:
   - 3 —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –¥–µ–Ω—å –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** –°–æ–∑–¥–∞—Ç—å "Smart Comparison" —Ä–µ–∂–∏–º:
   - –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ Enhanced AI
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–∏–π
   - –≠–∫–æ–Ω–æ–º–∏—è 50% —Ç–æ–∫–µ–Ω–æ–≤

## üí∞ **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è:**

–ï—Å–ª–∏ —Ä–µ–∂–∏–º `/compare` —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 20% –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
- **–¢–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã:** 100% + 20% = 120% —Ç–æ–∫–µ–Ω–æ–≤
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 100% + 10% = 110% —Ç–æ–∫–µ–Ω–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è:** ~8% –æ—Ç –æ–±—â–µ–≥–æ –±—é–¥–∂–µ—Ç–∞ –Ω–∞ OpenAI

## üöÄ **–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ - Smart Compare:**

```python
# –í–º–µ—Å—Ç–æ –¥–≤—É—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –¥–µ–ª–∞–µ–º –æ–¥–∏–Ω + –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
async def smart_compare(query, user_id, lang):
    # –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ Enhanced AI
    enhanced_result = await enhanced_ai_service.process_query(query, user_id, lang)

    # –ú–µ—Å—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è "–æ–±—ã—á–Ω–æ–≥–æ" –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–æ–≤
    template_answer = template_manager.find_best_template(query, lang)

    # –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –±–µ–∑ –≤—Ç–æ—Ä–æ–≥–æ API –∑–∞–ø—Ä–æ—Å–∞
    return format_smart_comparison(enhanced_result, template_answer)
```

---

**–í—ã–≤–æ–¥:** –î–∞, `/compare` —Ç—Ä–∞—Ç–∏—Ç –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É—é –¥–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –±–æ–ª–µ–µ —ç–∫–æ–Ω–æ–º–∏—á–Ω—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É.
